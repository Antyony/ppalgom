<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>들곰다대기 계산기</title>
  <style>
    :root { --b:#e5e7eb; --m:#6b7280; --bg:#fafafa; }
    body { margin:0; background:var(--bg); color:#111827;
      font-family: system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", Segoe UI, Roboto, Arial, sans-serif; }
    .wrap { max-width: 820px; margin: 24px auto; padding: 0 14px; }
    .card { background:#fff; border:1px solid var(--b); border-radius:14px; padding: 16px; }
    h1 { font-size: 18px; margin:0 0 12px; }
    .mode { display:flex; gap:14px; flex-wrap:wrap; align-items:center; }
    label { display:flex; gap:8px; align-items:center; cursor:pointer; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px; }
    input[type="number"]{ flex: 1 1 280px; padding: 10px 12px; font-size:16px; border:1px solid var(--b); border-radius:10px; }
    button { padding: 10px 14px; font-size: 15px; border-radius:10px; border:1px solid var(--b); background:#fff; cursor:pointer; }
    button:hover { background:#f9fafb; }
    .pill { display:inline-block; padding:2px 10px; border:1px solid var(--b); border-radius:999px; font-size:12px; color:var(--m); }
    .hint { color: var(--m); font-size: 12px; margin-top: 8px; line-height: 1.4; }
    .err { display:none; margin-top:10px; color:#b91c1c; font-size: 13px; }
    table { width:100%; border-collapse:collapse; margin-top: 14px; }
    th, td { border-bottom:1px solid var(--b); padding: 10px 8px; }
    th { text-align:left; color: var(--m); font-size: 12px; }
    td.num, th.num { text-align:right; font-variant-numeric: tabular-nums; }
    .meta { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>들곰다대기 계산기</h1>

      <div class="mode" role="radiogroup" aria-label="계산 기준 선택">
        <label><input type="radio" name="mode" value="weight" checked> 중량(g) 기준</label>
        <label><input type="radio" name="mode" value="servings"> 인분 기준</label>
        <span class="pill" id="unitPill">g</span>
      </div>

      <div class="row">
        <input id="valueInput" type="number" inputmode="decimal" min="0" step="0.01" placeholder="생산될 총 중량 (g) 입력" />
        <button id="calcBtn" type="button">계산하기</button>
      </div>

      <div class="hint">
        기준 레시피(1.2인분) 총중량: <strong id="baseTotalTxt"></strong> g (물 포함)<br/>
        ✅ 중량 기준은 “입력한 총중량”을 기준 레시피의 <strong>재료 비율대로</strong> 분배해.
      </div>

      <div class="err" id="err"></div>
      <div class="meta" id="meta" style="display:none;"></div>

      <table>
        <thead>
          <tr>
            <th>재료</th>
            <th class="num">기준(g)</th>
            <th class="num">계산(g)</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

<script>
(() => {
  const BASE_SERVINGS = 1.2;
  const ING = [
    { name: "들깨가루(국내산)", g: 15.00 },
    { name: "찹쌀가루",         g: 10.00 },
    { name: "백후추",           g: 0.10 },
    { name: "마늘가루",         g: 0.50 },
    { name: "물",              g: 27.50 }
  ];
  const BASE_TOTAL_G = ING.reduce((s, x) => s + x.g, 0);

  const radios = Array.from(document.querySelectorAll('input[name="mode"]'));
  const valueInput = document.getElementById('valueInput');
  const unitPill = document.getElementById('unitPill');
  const calcBtn = document.getElementById('calcBtn');
  const tbody = document.getElementById('tbody');
  const err = document.getElementById('err');
  const baseTotalTxt = document.getElementById('baseTotalTxt');
  const meta = document.getElementById('meta');

  baseTotalTxt.textContent = BASE_TOTAL_G.toFixed(2);

  function mode() {
    const r = radios.find(x => x.checked);
    return r ? r.value : "weight";
  }

  // 사용자 기대: 2자리 고정
  function fmt2(n) {
    if (!isFinite(n)) return "-";
    const v = Math.abs(n) < 1e-9 ? 0 : n; // -0.00 방지
    return v.toFixed(2);
  }

  function clearTable() {
    tbody.innerHTML = "";
    for (const it of ING) {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${it.name}</td><td class="num">${fmt2(it.g)}</td><td class="num">-</td>`;
      tbody.appendChild(tr);
    }
    meta.style.display = "none";
    meta.innerHTML = "";
  }

  function syncUI() {
    const m = mode();
    err.style.display = "none";
    err.textContent = "";
    if (m === "weight") {
      valueInput.placeholder = "생산될 총 중량 (g) 입력";
      unitPill.textContent = "g";
    } else {
      valueInput.placeholder = "생산될 인분 수 입력";
      unitPill.textContent = "인분";
    }
  }

  function calculate() {
    const m = mode();
    const rawStr = (valueInput.value || "").trim();
    const raw = Number(rawStr);

    err.style.display = "none";
    err.textContent = "";
    meta.style.display = "none";
    meta.innerHTML = "";

    if (!rawStr || !isFinite(raw) || raw <= 0) {
      err.style.display = "block";
      err.textContent = "값을 숫자로 입력해줘. (0보다 큰 값)";
      clearTable();
      return;
    }

    tbody.innerHTML = "";

    if (m === "weight") {
      // ✅ 중량 기준: 입력된 총중량(raw)을 기준 레시피 비율대로 분배
      for (const it of ING) {
        const ratio = it.g / BASE_TOTAL_G;
        const out = raw * ratio;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${it.name}</td><td class="num">${fmt2(it.g)}</td><td class="num">${fmt2(out)}</td>`;
        tbody.appendChild(tr);
      }
      meta.style.display = "";
      meta.innerHTML = `
        <span class="pill">입력 총중량: <strong>${raw.toFixed(2)} g</strong></span>
        <span class="pill">기준 총중량: <strong>${BASE_TOTAL_G.toFixed(2)} g</strong></span>
        <span class="pill">배수: <strong>${(raw / BASE_TOTAL_G).toFixed(6)} x</strong></span>
      `;
    } else {
      // 인분 기준: out = it.g * (raw / 1.2)
      const scale = raw / BASE_SERVINGS;
      for (const it of ING) {
        const out = it.g * scale;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${it.name}</td><td class="num">${fmt2(it.g)}</td><td class="num">${fmt2(out)}</td>`;
        tbody.appendChild(tr);
      }
      meta.style.display = "";
      meta.innerHTML = `
        <span class="pill">입력 인분: <strong>${raw.toFixed(2)} 인분</strong></span>
        <span class="pill">기준 인분: <strong>${BASE_SERVINGS.toFixed(2)} 인분</strong></span>
        <span class="pill">배수: <strong>${scale.toFixed(6)} x</strong></span>
      `;
    }
  }

  radios.forEach(r => r.addEventListener('change', () => { syncUI(); clearTable(); }));
  calcBtn.addEventListener('click', calculate);
  valueInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') calculate(); });

  // init
  syncUI();
  clearTable();
})();
</script>
</body>
</html>
